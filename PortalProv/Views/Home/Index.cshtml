@using System.Configuration
@{
    ViewBag.Title = "Home Page";
    var _List_MaximasFechas = (List<Wareways.PortalProv.Infraestructura.SP_PPROV_DeteccionFecha_PresentacionMax_Result>)ViewBag.MMP_List;
    var _List_MaximasFechasServ = (List<Wareways.PortalProv.Infraestructura.SP_PPROV_DeteccionFecha_PresentacionMaxServ_Result>)ViewBag.MMP_ListServ;
    var logoEmpresa = ConfigurationManager.AppSettings["LogoEmpresa"];
}



@section PageHeader {
    <section class="content-header">
        <h1>
            Inicio
            <small>Bienvenidos al Portal</small>
        </h1>
    </section>
}
@Html.Hidden("MPP", (String)ViewBag.MPP)
@if (User.Identity.Name == "")
{
    <div class="box box-default">
        <div class="box-body">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-6">
                        <div style="text-align:center">
                            <h1 style="font-weight:bolder">Portal Proveedores</h1>

                            <img src="@logoEmpresa" style="max-height: 200px; max-width:90%; width: auto;" />
                            <br />
                            Version 3.5 Ago 2025 Multi
                            <hr />
                            <img src="~/Content/LaptopIntro.jpg" width="100%" />
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div style="text-align:center">
                            <img src="~/Content/Beneficions del Portal Proveedores.png" width="100%" />
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>


}

@if (User.Identity.Name != "" && User.IsInRole("Proveedor"))
{
    <div class="row">
        @foreach (var Item in (List<Wareways.PortalProv.Infraestructura.SP_PPROV_Indicadores_Usuario_Result>)ViewBag.IndicadoresTop)
        {
            if (Item.Tipo == "Indicador")
            {
                <div class="col-lg-3 col-xs-6">
                    <!-- small box -->
                    <div class="small-box @Item.Fondo">
                        <div class="inner">
                            <h3>@Item.IndicardorValor</h3>
                            <p>@Item.IndicadorTexto</p>
                        </div>
                        <div class="icon">
                            <i class="@Item.Icono"></i>
                        </div>
                        <a href="@Item.URL" class="small-box-footer">Mas Información <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            }
            if (Item.Tipo == "Informativo")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon @Item.Fondo"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicardorValor</span>
                            <span class="info-box-text">@Item.IndicadorTexto2</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
            }
            if (Item.Tipo == "Progreso")
            {
                <div class="info-box @Item.Fondo">
                    <span class="info-box-icon"><i class="@Item.Icono"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">@Item.IndicadorTexto</span>
                        <span class="info-box-number">@Item.IndicardorValor</span>

                        <div class="progress">
                            <div class="progress-bar" style="width: @Item.Progreso%"></div>
                        </div>
                        <span class="progress-description">
                            @Item.IndicadorTexto2
                        </span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
            }

        }
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="box box-success">
                <div class="box-header with-border">
                    <h3 class="box-title">Facturas Aceptadas Ultimos 12 Meses</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                            <i class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="chart">
                        <canvas id="barChart" style="height: 230px; width: 787px;" height="230" width="787"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>

    </div>
    <div class="row">
        @foreach (var Item in (List<Wareways.PortalProv.Infraestructura.SP_PPROV_Indicadores_Usuario_Result>)ViewBag.IndicadoresBottom)
        {
            if (Item.Tipo == "Indicador")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <!-- small box -->
                    <div class="small-box @Item.Fondo">
                        <div class="inner">
                            <h3>@Item.IndicardorValor</h3>
                            <p>@Item.IndicadorTexto</p>
                        </div>
                        <div class="icon">
                            <i class="@Item.Icono"></i>
                        </div>
                        <a href="@Item.URL" class="small-box-footer">Mas Información <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            }
            if (Item.Tipo == "Informativo")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon @Item.Fondo"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicardorValor</span>
                            <span class="info-box-text">@Item.IndicadorTexto2</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
            }
            if (Item.Tipo == "Progreso")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box @Item.Fondo">
                        <span class="info-box-icon"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicardorValor</span>

                            <div class="progress">
                                <div class="progress-bar" style="width: @Item.Progreso%"></div>
                            </div>
                            <span class="progress-description">
                                @Item.IndicadorTexto2
                            </span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                </div>
            }

        }
    </div>

}

@if (User.Identity.Name != "" && User.IsInRole("Oficina"))
{
    <div class="row">
        @foreach (var Item in (List<Wareways.PortalProv.Infraestructura.SP_PPROV_Indicadores_Oficina_Result>)ViewBag.IndicadoresTopOficina)
        {
            if (Item.Tipo == "Indicador")
            {
                <div class="col-lg-3 col-xs-6">
                    <!-- small box -->
                    <div class="small-box @Item.Fondo">
                        <div class="inner">
                            <h3>@Item.IndicarValor</h3>
                            <p>@Item.IndicadorTexto</p>
                        </div>
                        <div class="icon">
                            <i class="@Item.Icono"></i>
                        </div>
                        <a href="@Item.URL" class="small-box-footer">Mas Información <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            }
            if (Item.Tipo == "Informativo")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon @Item.Fondo"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicarValor</span>
                            <span class="info-box-text">@Item.IndicadorTexto2</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
            }
            if (Item.Tipo == "Progreso")
            {
                <div class="info-box @Item.Fondo">
                    <span class="info-box-icon"><i class="@Item.Icono"></i></span>

                    <div class="info-box-content">
                        <span class="info-box-text">@Item.IndicadorTexto</span>
                        <span class="info-box-number">@Item.IndicarValor</span>

                        <div class="progress">
                            <div class="progress-bar" style="width: @Item.Progreso%"></div>
                        </div>
                        <span class="progress-description">
                            @Item.IndicadorTexto2
                        </span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
            }

        }
    </div>
    @*<div class="row">
            <div class="col-md-12">
                <div class="box box-success">
                    <div class="box-header with-border">
                        <h3 class="box-title">Facturas Aceptadas Ultimos 12 Meses</h3>

                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                <i class="fa fa-minus"></i>
                            </button>
                            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                        </div>
                    </div>
                    <div class="box-body">
                        <div class="chart">
                            <canvas id="barChart" style="height: 230px; width: 787px;" height="230" width="787"></canvas>
                        </div>
                    </div>
                     /.box-body
                </div>
            </div>

        </div>*@
    <div class="row">
        @foreach (var Item in (List<Wareways.PortalProv.Infraestructura.SP_PPROV_Indicadores_Oficina_Result>)ViewBag.IndicadoresBottomOficina)
        {
            if (Item.Tipo == "Indicador")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <!-- small box -->
                    <div class="small-box @Item.Fondo">
                        <div class="inner">
                            <h3>@Item.IndicarValor</h3>
                            <p>@Item.IndicadorTexto</p>
                        </div>
                        <div class="icon">
                            <i class="@Item.Icono"></i>
                        </div>
                        <a href="@Item.URL" class="small-box-footer">Mas Información <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            }
            if (Item.Tipo == "Informativo")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon @Item.Fondo"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicarValor</span>
                            <span class="info-box-text">@Item.IndicadorTexto2</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
            }
            if (Item.Tipo == "Progreso")
            {
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box @Item.Fondo">
                        <span class="info-box-icon"><i class="@Item.Icono"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">@Item.IndicadorTexto</span>
                            <span class="info-box-number">@Item.IndicarValor</span>

                            <div class="progress">
                                <div class="progress-bar" style="width: @Item.Progreso%"></div>
                            </div>
                            <span class="progress-description">
                                @Item.IndicadorTexto2
                            </span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                </div>
            }

        }
    </div>



}
<div class="modal fade in" id="modal-MMP" name="modal-MMP" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <div class="col-md-12">
                    <div class="col-md-3">
                        <img src="@logoEmpresa" width="150" />
                    </div>
                    <div class="col-md-6">
                        <h4 class="modal-title" style="color: #2b2e75; text-align: center"><strong>Operadora S.A. Informa las fecha límite para</strong> </h4>
                        <h4 class="modal-title" style="text-align:center"><strong>procesamiento de facturas de provedores </strong></h4>
                    </div>
                    <div class="col-md-3" style="color: #2b2e75; text-align: right; font-weight: bolder; font-size: x-large">
                        @ViewBag.MesLetras
                    </div>
                </div>

            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed table-hover">
                    @foreach (var _Item in _List_MaximasFechas)
                    {

                        <tr>
                            <td>(@_Item.CardCode) @_Item.CardName </td>
                            <td> Fecha Limite @ViewBag.MesLetras  </td>
                            <td><span class="glyphicon glyphicon-arrow-right" style="color: #2b2e75"></span> </td>
                            <td style="color: #2b2e75; font-weight: bolder">
                                @_Item.DiaMaximoSemana @_Item.Dia_Maximo Bienes &nbsp;&nbsp;


                                @if (_Item.Estado != "")
                                {
                                    <span class="badge bg-red">Plazo Vencido</span>
                                }
                                else
                                {
                                    <span class="badge bg-green">En Tiempo</span>
                                }
                            </td>
                        </tr>
                        foreach (var _next in _List_MaximasFechasServ.Where(p => p.CardCode == _Item.CardCode))
                        {
                            <tr>
                                <td></td>
                                <td></td>
                                <td><span class="glyphicon glyphicon-arrow-right" style="color: #2b2e75"></span> </td>
                                <td style="color: #2b2e75; font-weight: bolder">
                                    @_next.DiaMaximoSemana @_next.Dia_Maximo Servicio &nbsp;&nbsp;


                                    @if (_next.Estado != "")
                                    {
                                        <span class="badge bg-red">Plazo Vencido</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-green">En Tiempo</span>
                                    }
                                </td>
                            </tr>
                        }
                        <tr>
                            <td colspan="5"><span style="color: #2b2e75; font-weight: bolder"> Observaciones: &nbsp; </span> @_Item.Mensaje</td>
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <p style="font:smaller; text-align:center">
                    Para dudas o consultas sobre pagos a proveedores, comunicarte a:
                    @*<br />
                        <span style="color: #2b2e75; font-weight: bolder">PBX:</span> No Telefono <span style="color: #2b2e75; font-weight: bolder">
                            EXT:
                        </span> extensiones*@
                    <br />
                    <span style="color: #2b2e75; font-weight: bolder">CORREO: </span>
                    <a href="mailto:gestiondepagos@servicioscorp.com">gestiondepagos@servicioscorp.com ,

                </p>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

@section Scripts
{
    <script src="/admin-lte/bower_components/chart.js/Chart.js"></script>
    <script>

        $(function () {
            /* ChartJS
             * -------
             * Here we will create a few charts using ChartJS
             */

            var areaChartData = {
                labels: [@Html.Raw( @ViewBag.DataTitulo)],
                datasets: [
                    {
                        label: 'Monto',
                        fillColor: 'rgba(60,141,188,0.9)',
                        strokeColor: 'rgba(210, 214, 222, 1)',
                        pointColor: 'rgba(210, 214, 222, 1)',
                        pointStrokeColor: '#c1c7d1',
                        pointHighlightFill: '#fff',
                        pointHighlightStroke: 'rgba(220,220,220,1)',
                        data: [@ViewBag.DataTotal]
                    }
                ]
            }

            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $('#barChart').get(0).getContext('2d')
            var barChart = new Chart(barChartCanvas)
            var barChartData = areaChartData

            var barChartOptions = {
                //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                scaleBeginAtZero: true,
                //Boolean - Whether grid lines are shown across the chart
                scaleShowGridLines: true,
                //String - Colour of the grid lines
                scaleGridLineColor: 'rgba(0,0,0,.05)',
                //Number - Width of the grid lines
                scaleGridLineWidth: 1,
                //Boolean - Whether to show horizontal lines (except X axis)
                scaleShowHorizontalLines: true,
                //Boolean - Whether to show vertical lines (except Y axis)
                scaleShowVerticalLines: true,
                //Boolean - If there is a stroke on each bar
                barShowStroke: true,
                //Number - Pixel width of the bar stroke
                barStrokeWidth: 2,
                //Number - Spacing between each of the X value sets
                barValueSpacing: 5,
                //Number - Spacing between data sets within X values
                barDatasetSpacing: 1,
                //String - A legend template
                legendTemplate: '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',
                //Boolean - whether to make the chart responsive
                responsive: true,
                maintainAspectRatio: true
            }

            barChartOptions.datasetFill = false
            barChart.Bar(barChartData, barChartOptions)
        })

    </script>
    <script>
        $(document).ready(function () {
            if ($('#MPP').val() == "1") {
                $("#modal-MMP").modal('show');
            }
        });
    </script>
}
